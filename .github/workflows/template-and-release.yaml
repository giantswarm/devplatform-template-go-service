name: Template and release project

on:
  push:
    tags:
      - "*"
  pull_request:
  workflow_dispatch: {}

# defaults:
#   run:
#     working-directory: rendered-project

jobs:
  checkout:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332 # v4
      - name: Install boilerplate
        run: curl -fsSL https://github.com/gruntwork-io/boilerplate/releases/latest/download/boilerplate_linux_amd64 -o /usr/local/bin/boilerplate && chmod +x /usr/local/bin/boilerplate
      - name: Copy the current state for use with templating
        run: cp -a project-template/ boilerplate-values.yml /tmp
      - name: Create and checkout temp branch
        run: |
          git checkout rendered-project
      - name: Run boilerplate
        run: boilerplate --non-interactive --template-url /tmp/project-template --output-folder . --var-file /tmp/boilerplate-values.yml
      - name: Commit rendered project
        id: cpr
        uses: peter-evans/create-pull-request@v7
      - name: Check outputs
        if: ${{ steps.cpr.outputs.pull-request-number }}
        run: |
          echo "Pull Request Number - ${{ steps.cpr.outputs.pull-request-number }}"
          echo "Pull Request URL - ${{ steps.cpr.outputs.pull-request-url }}"
